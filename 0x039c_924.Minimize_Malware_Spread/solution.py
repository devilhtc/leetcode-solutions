class Solution:
    def minMalwareSpread(self, graph, initial):
        """
        :type graph: List[List[int]]
        :type initial: List[int]
        :rtype: int
        """
        # build graph for faster access
        g = collections.defaultdict(list)
        n = len(graph)
        for i in range(n):
            for j in range(n):
                if i != j and graph[i][j]:
                    g[i].append(j)
        groups = [0] * n

        def dfs(i, c):
            if groups[i] != 0:
                return
            groups[i] = c
            for j in g[i]:
                dfs(j, c)

        # use dfs to find connected components
        c = 0
        for i in range(n):
            if groups[i] == 0:
                c += 1
                dfs(i, c)

        # group number -> group size
        i2s = collections.defaultdict(int)
        # group number -> number of initially infected nodes
        i2i = collections.defaultdict(int)

        for i in range(n):
            i2s[groups[i]] = i2s[groups[i]] + 1
        for i in initial:
            i2i[groups[i]] = i2i[groups[i]] + 1

        # diff: number of nodes saved (except it self)
        out = min(initial)
        max_diff = 0
        for i in initial:
            c = groups[i]
            if i2i[c] == 1:
                diff = i2s[c] - 1
                if diff > max_diff:
                    max_diff = diff
                    out = i
                elif diff == max_diff:
                    out = min(out, i)

        return out
