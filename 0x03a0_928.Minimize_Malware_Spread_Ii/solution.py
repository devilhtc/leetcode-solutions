class Solution:
    def minMalwareSpread(self, graph, initial):
        """
        :type graph: List[List[int]]
        :type initial: List[int]
        :rtype: int
        """
        l = len(graph)
        g = [[] for _ in range(l)]
        initial_set = set(initial)
        for i in range(l):
            for j in range(l):
                if i != j and graph[i][j]:
                    g[i].append(j)

        # find strongly connected components of nodes not in initial
        belongs = [-1] * l

        def dfs(i, s):
            if i in initial_set:
                return
            if belongs[i] != -1:
                return
            belongs[i] = s
            for c in g[i]:
                dfs(c, s)

        s = 0
        for i in range(l):
            if belongs[i] == -1 and i not in initial_set:
                dfs(i, s)
                s += 1

        ssc_size = [0] * s  # s to size
        ssc_sources = [[] for _ in range(s)]  # s to initial that can affect s

        for i in range(l):
            if belongs[i] != -1:
                ssc_size[belongs[i]] = ssc_size[belongs[i]] + 1

        for i in initial:
            for c in g[i]:
                k = belongs[c]
                if k != -1:
                    if i not in ssc_sources[k]:
                        ssc_sources[k].append(i)

        i2s = collections.defaultdict(int)  # initial -> number of saved
        for i in range(s):
            if len(ssc_sources[i]) == 1:
                i2s[ssc_sources[i][0]] = i2s[ssc_sources[i][0]] + ssc_size[i]

        out = min(initial)
        for i, v in dict(i2s).items():
            if v > i2s[out]:
                out = i
            elif v == i2s[out]:
                out = min(i, out)

        return out
